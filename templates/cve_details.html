{% extends "layout.html" %}

{% block title %}{{ cve.cve_id }} - CVE Details{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="card shadow-sm">
        <div class="card-header bg-light d-flex justify-content-between align-items-center">
            <h1 class="h4 mb-0 text-primary"><i class="bi bi-bug me-2"></i>{{ cve.cve_id }}</h1>
            {% if from_api %}
                <span class="badge bg-info text-dark">Fetched from NVD API</span>
            {% else %}
                 <span class="badge bg-success">From Local Database</span>
            {% endif %}
        </div>
        <div class="card-body">
            <!-- Severity and Scores -->
            <div class="row mb-3">
                <div class="col-md-4">
                    <strong>Severity:</strong>
                    {% if cve.severity == 'CRITICAL' %}
                    <span class="badge rounded-pill badge-critical fs-6 ms-2"><i class="bi bi-exclamation-octagon-fill me-1"></i>Critical</span>
                    {% elif cve.severity == 'HIGH' %}
                    <span class="badge rounded-pill badge-high fs-6 ms-2"><i class="bi bi-exclamation-triangle-fill me-1"></i>High</span>
                    {% elif cve.severity == 'MEDIUM' %}
                    <span class="badge rounded-pill badge-medium fs-6 ms-2"><i class="bi bi-exclamation-circle-fill me-1"></i>Medium</span>
                    {% elif cve.severity == 'LOW' %}
                    <span class="badge rounded-pill badge-low fs-6 ms-2"><i class="bi bi-info-circle-fill me-1"></i>Low</span>
                    {% else %}
                    <span class="badge rounded-pill badge-unknown fs-6 ms-2"><i class="bi bi-question-circle-fill me-1"></i>Unknown</span>
                    {% endif %}
                </div>
                <div class="col-md-4">
                    <strong>CVSS v3 Score:</strong>
                    {% if cve.cvss_v3_score %}
                        <span class="badge bg-dark ms-2">{{ cve.cvss_v3_score }}</span>
                    {% else %}
                        <span class="text-muted ms-2">N/A</span>
                    {% endif %}
                </div>
                <div class="col-md-4">
                    <strong>CVSS v2 Score:</strong>
                     {% if cve.cvss_v2_score %}
                        <span class="badge bg-secondary ms-2">{{ cve.cvss_v2_score }}</span>
                    {% else %}
                        <span class="text-muted ms-2">N/A</span>
                    {% endif %}
                </div>
            </div>

            <!-- Dates -->
            <div class="row mb-3">
                <div class="col-md-6">
                    <strong>Published Date:</strong>
                    <span class="ms-2">{{ cve.published_date.strftime('%Y-%m-%d %H:%M:%S') if cve.published_date else 'N/A' }}</span>
                </div>
                <div class="col-md-6">
                    <strong>Last Modified:</strong>
                    <span class="ms-2">{{ cve.last_modified_date.strftime('%Y-%m-%d %H:%M:%S') if cve.last_modified_date else 'N/A' }}</span>
                </div>
            </div>

            <!-- Description -->
            <div class="mb-4">
                <h5 class="text-secondary"><i class="bi bi-file-text me-2"></i>Description</h5>
                <p class="text-body bg-light p-3 rounded">{{ cve.description | safe }}</p>
            </div>

            <!-- CWE -->
            {% if cve.cwe_id %}
            <div class="mb-4">
                <h5 class="text-secondary"><i class="bi bi-diagram-3 me-2"></i>Weakness Enumeration (CWE)</h5>
                {# Assuming cwe_id is a comma-separated string #}
                {% set cwe_list = cve.cwe_id.split(',') %}
                {% for cwe in cwe_list %}
                    <span class="badge bg-light text-dark border me-1 mb-1 p-2">{{ cwe.strip() }}</span>
                {% endfor %}
            </div>
            {% endif %}

            <!-- References -->
            {% if cve.references %}
            <div class="mb-4">
                <h5 class="text-secondary"><i class="bi bi-link-45deg me-2"></i>References</h5>
                <ul class="list-group list-group-flush">
                    {# Assuming references is a comma-separated string #}
                    {% set ref_list = cve.references.split(',') %}
                    {% for ref in ref_list %}
                        {% if ref.strip() %}
                        <li class="list-group-item px-0 py-1">
                            <a href="{{ ref.strip() }}" target="_blank" rel="noopener noreferrer">{{ ref.strip() }}</a>
                        </li>
                        {% endif %}
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            <!-- CPE Affected -->
            {% if cve.cpe_affected %}
             <div class="mb-4">
                <h5 class="text-secondary"><i class="bi bi-cpu me-2"></i>Affected Configurations (CPE)</h5>
                <div style="max-height: 200px; overflow-y: auto; background-color: #f8f9fa; padding: 10px; border-radius: 5px;">
                    <ul class="list-unstyled mb-0 small">
                         {# Assuming cpe_affected is a comma-separated string #}
                        {% set cpe_list = cve.cpe_affected.split(',') %}
                        {% for cpe in cpe_list %}
                             {% if cpe.strip() %}
                            <li><code>{{ cpe.strip() }}</code></li>
                             {% endif %}
                        {% endfor %}
                    </ul>
                </div>
            </div>
            {% endif %}

            <div class="mt-4">
                 <a href="{{ request.referrer or url_for('index') }}" class="btn btn-outline-secondary">
                     <i class="bi bi-arrow-left me-1"></i>Back
                 </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_head %}
{# Reuse badge styles from index.html if needed, or define here #}
<style>
    .badge-critical { background-color: #dc3545; }
    .badge-high { background-color: #fd7e14; }
    .badge-medium { background-color: #ffc107; color: #000 !important; } /* Ensure text is dark */
    .badge-low { background-color: #0dcaf0; color: #000 !important; } /* Ensure text is dark */
    .badge-unknown { background-color: #6c757d; }
    code { font-size: 0.8em; }
</style>
{% endblock %}