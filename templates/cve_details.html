{% extends 'layout.html' %}

{% block title %}CVE Details - {{ cve.cve_id if not from_api else cve.cve_id }}{% endblock %}

{% block extra_head %}
<style>
    .cve-header {
        background-color: #f8f9fa;
        border-left: 5px solid #0d6efd;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 5px;
    }
    
    .severity-badge {
        font-size: 1rem;
        padding: 0.5rem 0.75rem;
    }
    
    .cvss-meter {
        position: relative;
        margin-bottom: 1.5rem;
    }
    
    .cvss-gauge-container {
        height: 200px;
        position: relative;
    }
    
    .cvss-label {
        position: absolute;
        top: 70%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 0.9rem;
        color: #6c757d;
    }
    
    .cvss-value {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 2rem;
        font-weight: bold;
    }
    
    .severity-circle {
        width: 64px;
        height: 64px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 1rem;
        margin-bottom: 0.5rem;
    }
    
    .circle-critical { background-color: #dc3545; }
    .circle-high { background-color: #fd7e14; }
    .circle-medium { background-color: #ffc107; color: #212529; }
    .circle-low { background-color: #0dcaf0; color: #212529; }
    .circle-unknown { background-color: #6c757d; }
    
    .timeline {
        position: relative;
        padding-left: 30px;
        margin-bottom: 1.5rem;
    }
    
    .timeline::before {
        content: '';
        position: absolute;
        top: 0;
        left: 15px;
        height: 100%;
        width: 2px;
        background-color: #dee2e6;
    }
    
    .timeline-item {
        position: relative;
        margin-bottom: 1.5rem;
    }
    
    .timeline-item::before {
        content: '';
        position: absolute;
        left: -21px;
        top: 0;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background-color: #0d6efd;
    }
    
    .timeline-date {
        font-weight: bold;
        margin-bottom: 0.25rem;
    }
    
    .timeline-content {
        padding: 0.75rem;
        background-color: #f8f9fa;
        border-radius: 0.25rem;
    }
    
    .reference-link {
        display: block;
        padding: 0.5rem;
        margin-bottom: 0.5rem;
        background-color: #f8f9fa;
        border-radius: 0.25rem;
        transition: all 0.2s;
        position: relative;
        padding-left: 2rem;
        text-decoration: none;
    }
    
    .reference-link:hover {
        background-color: #e9ecef;
        transform: translateY(-2px);
    }
    
    .reference-link i {
        position: absolute;
        left: 0.75rem;
        top: 50%;
        transform: translateY(-50%);
    }
    
    .reference-type {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        font-size: 0.75rem;
        border-radius: 0.25rem;
        margin-right: 0.5rem;
        background-color: #e9ecef;
    }
    
    .cpe-item {
        position: relative;
        padding: 0.75rem;
        background-color: #f8f9fa;
        border-radius: 0.25rem;
        margin-bottom: 0.5rem;
        font-family: monospace;
        font-size: 0.9rem;
        border-left: 3px solid #0d6efd;
        transition: all 0.2s;
    }
    
    .cpe-item:hover {
        background-color: #e9ecef;
        transform: translateX(5px);
    }
    
    .cpe-vendor {
        color: #0d6efd;
        font-weight: bold;
    }
    
    .cpe-product {
        color: #dc3545;
        font-weight: bold;
    }
    
    .cpe-version {
        color: #fd7e14;
        font-weight: bold;
    }
    
    .chart-container {
        height: 240px;
        position: relative;
    }
    
    .cvss-component-list {
        list-style: none;
        padding: 0;
    }
    
    .cvss-component-list li {
        padding: 0.5rem 0;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
    }
    
    .component-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 0.5rem;
    }
    
    .data-card {
        transition: all 0.3s;
        height: 100%;
    }
    
    .data-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    }
    
    .impact-icon {
        font-size: 1.5rem;
        margin-right: 0.5rem;
    }
    
    .exploit-score {
        font-size: 2rem;
        font-weight: bold;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">Home</a></li>
            <li class="breadcrumb-item active" aria-current="page">CVE Details</li>
        </ol>
    </nav>

    <!-- CVE Header with ID and Severity -->
    <div class="cve-header rounded shadow-sm">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="mb-0">{{ cve.cve_id if not from_api else cve.cve_id }}</h1>
            </div>
            <div class="col-md-4 text-md-end mt-2 mt-md-0">
                {% set severity = cve.severity if not from_api else cve.severity %}
                {% if severity %}
                <span class="badge severity-badge severity-{{ severity }}">
                    <i class="bi bi-exclamation-triangle-fill me-1"></i>{{ severity }}
                </span>
                {% else %}
                <span class="badge severity-badge severity-UNKNOWN">UNKNOWN</span>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="row">
        <!-- CVE Information Column -->
        <div class="col-lg-8">
            <!-- Description Card -->
            <div class="card shadow-sm mb-4 data-card">
                <div class="card-header bg-primary text-white">
                    <h2 class="h5 mb-0"><i class="bi bi-info-circle me-2"></i>Description</h2>
                </div>
                <div class="card-body">
                    <p class="card-text">{{ cve.description if not from_api else cve.description }}</p>
                </div>
            </div>

            <!-- CVSS Score Visualization -->
            <div class="card shadow-sm mb-4 data-card">
                <div class="card-header bg-primary text-white">
                    <h2 class="h5 mb-0"><i class="bi bi-graph-up me-2"></i>CVSS Scores</h2>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h3 class="h6 mb-3 text-center">CVSS v3 Score</h3>
                            <div class="cvss-gauge-container">
                                <canvas id="cvssV3Gauge"></canvas>
                                {% set cvss_v3 = cve.cvss_v3_score if not from_api else cve.cvss_v3_score %}
                                <div class="cvss-value" id="cvssV3Value">
                                    {% if cvss_v3 %}{{ cvss_v3 }}{% else %}N/A{% endif %}
                                </div>
                                <div class="cvss-label">Base Score</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h3 class="h6 mb-3 text-center">CVSS v2 Score</h3>
                            <div class="cvss-gauge-container">
                                <canvas id="cvssV2Gauge"></canvas>
                                {% set cvss_v2 = cve.cvss_v2_score if not from_api else cve.cvss_v2_score %}
                                <div class="cvss-value" id="cvssV2Value">
                                    {% if cvss_v2 %}{{ cvss_v2 }}{% else %}N/A{% endif %}
                                </div>
                                <div class="cvss-label">Base Score</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- CVSS Vector Analysis (simulated) -->
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <h3 class="h6 mb-3">CVSS Vector Components</h3>
                            <div class="chart-container">
                                <canvas id="cvssRadarChart"></canvas>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h3 class="h6 mb-3">Component Details</h3>
                            <ul class="cvss-component-list">
                                <li>
                                    <span><span class="component-indicator" style="background-color: rgba(255, 99, 132, 0.7);"></span>Attack Vector</span>
                                    <span class="badge bg-light text-dark">Network</span>
                                </li>
                                <li>
                                    <span><span class="component-indicator" style="background-color: rgba(54, 162, 235, 0.7);"></span>Attack Complexity</span>
                                    <span class="badge bg-light text-dark">Low</span>
                                </li>
                                <li>
                                    <span><span class="component-indicator" style="background-color: rgba(255, 206, 86, 0.7);"></span>Privileges Required</span>
                                    <span class="badge bg-light text-dark">None</span>
                                </li>
                                <li>
                                    <span><span class="component-indicator" style="background-color: rgba(75, 192, 192, 0.7);"></span>User Interaction</span>
                                    <span class="badge bg-light text-dark">Required</span>
                                </li>
                                <li>
                                    <span><span class="component-indicator" style="background-color: rgba(153, 102, 255, 0.7);"></span>Scope</span>
                                    <span class="badge bg-light text-dark">Unchanged</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Impact Assessment -->
            <div class="card shadow-sm mb-4 data-card">
                <div class="card-header bg-primary text-white">
                    <h2 class="h5 mb-0"><i class="bi bi-shield-exclamation me-2"></i>Impact Assessment</h2>
                </div>
                <div class="card-body">
                    <div class="row text-center mb-4">
                        <div class="col-md-4">
                            <h3 class="h6 mb-2">Confidentiality</h3>
                            <div class="impact-icon text-danger">
                                <i class="bi bi-lock"></i>
                            </div>
                            <div class="h4">High</div>
                            <div class="small text-muted">Complete information disclosure</div>
                        </div>
                        <div class="col-md-4">
                            <h3 class="h6 mb-2">Integrity</h3>
                            <div class="impact-icon text-warning">
                                <i class="bi bi-shield-check"></i>
                            </div>
                            <div class="h4">Medium</div>
                            <div class="small text-muted">Modification of some system files</div>
                        </div>
                        <div class="col-md-4">
                            <h3 class="h6 mb-2">Availability</h3>
                            <div class="impact-icon text-info">
                                <i class="bi bi-hdd-network"></i>
                            </div>
                            <div class="h4">Low</div>
                            <div class="small text-muted">Minimal performance impact</div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <h3 class="h6 mb-2">Exploitability Score</h3>
                            <div class="text-center p-3 bg-light rounded">
                                <div class="exploit-score text-danger">8.6</div>
                                <div class="text-muted">Easily Exploitable</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h3 class="h6 mb-2">Remediation Level</h3>
                            <div class="text-center p-3 bg-light rounded">
                                <div class="h3">
                                    <i class="bi bi-patch-check text-success"></i>
                                </div>
                                <div class="h5">Official Fix</div>
                                <div class="text-muted">Complete vendor solution available</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CPE Configurations Card -->
            <div class="card shadow-sm mb-4 data-card">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h2 class="h5 mb-0"><i class="bi bi-pc-display me-2"></i>Affected Configurations</h2>
                    <button class="btn btn-sm btn-light" id="toggle-cpe">Show All</button>
                </div>
                <div class="card-body">
                    {% if not from_api and cve.cpe_affected %}
                        {% set cpe_list = cve.cpe_affected.split(',') %}
                        <div class="cpe-list" id="cpe-list">
                            {% for cpe in cpe_list[:5] %}
                                <div class="cpe-item">
                                    {% set parts = cpe.split(':') %}
                                    {% if parts|length >= 5 %}
                                        <i class="bi bi-hdd-stack me-2"></i>
                                        <span class="cpe-vendor">{{ parts[3] }}</span> : 
                                        <span class="cpe-product">{{ parts[4] }}</span>
                                        {% if parts|length >= 6 and parts[5] != '*' %}
                                         : <span class="cpe-version">{{ parts[5] }}</span>
                                        {% endif %}
                                    {% else %}
                                        {{ cpe }}
                                    {% endif %}
                                </div>
                            {% endfor %}
                            
                            {% if cpe_list|length > 5 %}
                            <div class="cpe-hidden d-none">
                                {% for cpe in cpe_list[5:] %}
                                    <div class="cpe-item">
                                        {% set parts = cpe.split(':') %}
                                        {% if parts|length >= 5 %}
                                            <i class="bi bi-hdd-stack me-2"></i>
                                            <span class="cpe-vendor">{{ parts[3] }}</span> : 
                                            <span class="cpe-product">{{ parts[4] }}</span>
                                            {% if parts|length >= 6 and parts[5] != '*' %}
                                             : <span class="cpe-version">{{ parts[5] }}</span>
                                            {% endif %}
                                        {% else %}
                                            {{ cpe }}
                                        {% endif %}
                                    </div>
                                {% endfor %}
                            </div>
                            <div class="cpe-count text-muted small mb-2">
                                + {{ cpe_list|length - 5 }} more configurations
                            </div>
                            {% endif %}
                        </div>
                    {% elif from_api and cve.configurations %}
                        <div class="cpe-list" id="cpe-list">
                            <!-- Logic for API returned CPE configurations -->
                            <!-- This would need to be customized based on your API response structure -->
                            <div class="alert alert-info">
                                <i class="bi bi-info-circle me-2"></i>
                                Detailed CPE configuration data available from API.
                            </div>
                        </div>
                    {% else %}
                        <p class="text-muted">
                            <i class="bi bi-exclamation-circle me-2"></i>
                            No CPE configuration data available.
                        </p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Metadata Column -->
        <div class="col-lg-4">
            <!-- Severity Overview Card -->
            <div class="card shadow-sm mb-4 data-card">
                <div class="card-header bg-secondary text-white">
                    <h2 class="h5 mb-0"><i class="bi bi-exclamation-triangle me-2"></i>Severity Overview</h2>
                </div>
                <div class="card-body text-center">
                    {% set severity = cve.severity if not from_api else cve.severity %}
                    {% if severity %}
                        <div class="severity-circle circle-{{ severity.lower() }}">
                            {% if severity == 'CRITICAL' %}
                                <i class="bi bi-exclamation-octagon-fill"></i>
                            {% elif severity == 'HIGH' %}
                                <i class="bi bi-exclamation-triangle-fill"></i>
                            {% elif severity == 'MEDIUM' %}
                                <i class="bi bi-exclamation-circle-fill"></i>
                            {% elif severity == 'LOW' %}
                                <i class="bi bi-info-circle-fill"></i>
                            {% else %}
                                <i class="bi bi-question-circle-fill"></i>
                            {% endif %}
                        </div>
                        <h3 class="h4 mb-3">{{ severity }}</h3>
                        
                        <div class="mt-3 text-start">
                            <div class="mb-2">
                                <div class="d-flex justify-content-between">
                                    <span>Attack Difficulty:</span>
                                    <span class="badge bg-success">Low</span>
                                </div>
                            </div>
                            <div class="mb-2">
                                <div class="d-flex justify-content-between">
                                    <span>Exploit Availability:</span>
                                    <span class="badge bg-warning text-dark">Proof-of-Concept</span>
                                </div>
                            </div>
                            <div class="mb-2">
                                <div class="d-flex justify-content-between">
                                    <span>Patch Status:</span>
                                    <span class="badge bg-success">Available</span>
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <div class="severity-circle circle-unknown">
                            <i class="bi bi-question-circle-fill"></i>
                        </div>
                        <h3 class="h4 mb-3">UNKNOWN</h3>
                        <p class="text-muted">Severity information not available</p>
                    {% endif %}
                </div>
            </div>

            <!-- Timeline Card -->
            <div class="card shadow-sm mb-4 data-card">
                <div class="card-header bg-secondary text-white">
                    <h2 class="h5 mb-0"><i class="bi bi-calendar-event me-2"></i>Timeline</h2>
                </div>
                <div class="card-body">
                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="timeline-date">
                                <i class="bi bi-calendar-plus me-1"></i>Published
                            </div>
                            <div class="timeline-content">
                                {% if not from_api and cve.published_date %}
                                    {{ cve.published_date.strftime('%Y-%m-%d') }}
                                {% elif from_api and cve.published_date %}
                                    {{ cve.published_date }}
                                {% else %}
                                    Unknown
                                {% endif %}
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-date">
                                <i class="bi bi-calendar-check me-1"></i>Last Modified
                            </div>
                            <div class="timeline-content">
                                {% if not from_api and cve.last_modified_date %}
                                    {{ cve.last_modified_date.strftime('%Y-%m-%d') }}
                                {% elif from_api and cve.last_modified_date %}
                                    {{ cve.last_modified_date }}
                                {% else %}
                                    Unknown
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CWE Information Card -->
            <div class="card shadow-sm mb-4 data-card">
                <div class="card-header bg-secondary text-white">
                    <h2 class="h5 mb-0"><i class="bi bi-tag me-2"></i>Classification</h2>
                </div>
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="flex-shrink-0">
                            <i class="bi bi-bug text-danger fs-4"></i>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h6 class="mb-0">CWE ID</h6>
                            <div>
                                {% if cve.cwe_id %}
                                    <span class="badge bg-light text-dark">{{ cve.cwe_id }}</span>
                                {% else %}
                                    <span class="text-muted">Not Specified</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <i class="bi bi-diagram-3 text-primary fs-4"></i>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h6 class="mb-0">Vulnerability Type</h6>
                            <div>
                                {% if cve.cwe_id %}
                                    {% if 'CWE-89' in cve.cwe_id %}
                                        <span class="badge bg-light text-dark">SQL Injection</span>
                                    {% elif 'CWE-79' in cve.cwe_id %}
                                        <span class="badge bg-light text-dark">Cross-site Scripting (XSS)</span>
                                    {% elif 'CWE-20' in cve.cwe_id %}
                                        <span class="badge bg-light text-dark">Input Validation</span>
                                    {% elif 'CWE-352' in cve.cwe_id %}
                                        <span class="badge bg-light text-dark">Cross-Site Request Forgery (CSRF)</span>
                                    {% elif 'CWE-78' in cve.cwe_id %}
                                        <span class="badge bg-light text-dark">OS Command Injection</span>
                                    {% else %}
                                        <span class="badge bg-light text-dark">Other Vulnerability</span>
                                    {% endif %}
                                {% else %}
                                    <span class="text-muted">Not Classified</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- References Card -->
            <div class="card shadow-sm mb-4 data-card">
                <div class="card-header bg-secondary text-white">
                    <h2 class="h5 mb-0"><i class="bi bi-link-45deg me-2"></i>References</h2>
                </div>
                <div class="card-body">
                    {% if not from_api and cve.references %}
                        {% set ref_list = cve.references.split(',') %}
                        {% if ref_list|length > 0 %}
                            <div class="reference-container">
                                {% for ref in ref_list %}
                                    <a href="{{ ref }}" class="reference-link" target="_blank" rel="noopener">
                                        <i class="bi bi-link"></i>
                                        {% if 'github.com' in ref %}
                                            <span class="reference-type">GitHub</span>
                                        {% elif 'cve.mitre.org' in ref %}
                                            <span class="reference-type">MITRE</span>
                                        {% elif 'nvd.nist.gov' in ref %}
                                            <span class="reference-type">NVD</span>
                                        {% elif 'exploit-db.com' in ref %}
                                            <span class="reference-type">Exploit</span>
                                        {% elif 'packetstormsecurity' in ref %}
                                            <span class="reference-type">Exploit</span>
                                        {% else %}
                                            <span class="reference-type">Web</span>
                                        {% endif %}
                                        {{ ref.replace('http://', '').replace('https://', '')[:40] }}{% if ref.replace('http://', '').replace('https://', '')|length > 40 %}...{% endif %}
                                    </a>
                                {% endfor %}
                            </div>
                        {% else %}
                            <p class="text-muted">No references available.</p>
                        {% endif %}
                    {% elif from_api and cve.references %}
                        <!-- Logic for API returned references -->
                        <div class="reference-container">
                            <!-- This would need to be customized based on your API response structure -->
                        </div>
                    {% else %}
                        <p class="text-muted">
                            <i class="bi bi-exclamation-circle me-2"></i>
                            No references available.
                        </p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // CVSS v3 Gauge Chart
        const cvssV3Value = {{ cve.cvss_v3_score|default(0) if not from_api else cve.cvss_v3_score|default(0) }};
        const cvssV3Gauge = document.getElementById('cvssV3Gauge');
        
        if (cvssV3Gauge) {
            const cvssV3Chart = new Chart(cvssV3Gauge, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [cvssV3Value, 10 - cvssV3Value],
                        backgroundColor: [
                            getCvssColor(cvssV3Value),
                            '#f0f0f0'
                        ],
                        borderWidth: 0,
                        circumference: 180,
                        rotation: 270
                    }]
                },
                options: {
                    cutout: '70%',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            enabled: false
                        },
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        // CVSS v2 Gauge Chart
        const cvssV2Value = {{ cve.cvss_v2_score|default(0) if not from_api else cve.cvss_v2_score|default(0) }};
        const cvssV2Gauge = document.getElementById('cvssV2Gauge');
        
        if (cvssV2Gauge) {
            const cvssV2Chart = new Chart(cvssV2Gauge, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [cvssV2Value, 10 - cvssV2Value],
                        backgroundColor: [
                            getCvssColor(cvssV2Value),
                            '#f0f0f0'
                        ],
                        borderWidth: 0,
                        circumference: 180,
                        rotation: 270
                    }]
                },
                options: {
                    cutout: '70%',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            enabled: false
                        },
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        // CVSS Vector Radar Chart (example values)
        const cvssRadarChart = document.getElementById('cvssRadarChart');
        
        if (cvssRadarChart) {
            new Chart(cvssRadarChart, {
                type: 'radar',
                data: {
                    labels: ['Attack Vector', 'Attack Complexity', 'Privileges Required', 'User Interaction', 'Scope'],
                    datasets: [{
                        label: 'CVSS Components',
                        data: [0.9, 0.7, 1.0, 0.6, 0.8],
                        fill: true,
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgb(54, 162, 235)',
                        pointBackgroundColor: 'rgb(54, 162, 235)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgb(54, 162, 235)'
                    }]
                },
                options: {
                    elements: {
                        line: {
                            borderWidth: 3
                        }
                    },
                    scales: {
                        r: {
                            angleLines: {
                                display: true
                            },
                            suggestedMin: 0,
                            suggestedMax: 1
                        }
                    }
                }
            });
        }
        
        // Color the CVSS progress bars based on severity
        function getCvssColor(score) {
            if (!score) return '#6c757d'; // gray for unknown
            if (score >= 9.0) return '#dc3545'; // red for critical
            if (score >= 7.0) return '#fd7e14'; // orange for high
            if (score >= 4.0) return '#ffc107'; // yellow for medium
            return '#0dcaf0'; // blue for low
        }

        // Toggle CPE configurations visibility
        const toggleCpeBtn = document.getElementById('toggle-cpe');
        const cpeHidden = document.querySelector('.cpe-hidden');
        const cpeCount = document.querySelector('.cpe-count');
        
        if (toggleCpeBtn && cpeHidden && cpeCount) {
            toggleCpeBtn.addEventListener('click', function() {
                if (cpeHidden.classList.contains('d-none')) {
                    cpeHidden.classList.remove('d-none');
                    cpeCount.classList.add('d-none');
                    toggleCpeBtn.textContent = 'Show Less';
                } else {
                    cpeHidden.classList.add('d-none');
                    cpeCount.classList.remove('d-none');
                    toggleCpeBtn.textContent = 'Show All';
                }
            });
        }
    });
</script>
{% endblock %}